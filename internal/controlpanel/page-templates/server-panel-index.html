<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>ByteJammer</title>

        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="jtruk/RiFT">

        <link href="/static/package/bootstrap-5.3.8-dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="/static/style/default.css" />
        <link rel="icon" type="image/x-icon" href="/static/media/favicon/favicon.ico">
    </head>
    <body>
        <div class="container">
            <div id="header">
                <h1>Server Panel</h1>
            </div>
            
            <p>Websocket status: <span id="ws-local-status"></span></p>

            <textarea id="log" style="display: none"></textarea>

            <button onclick="toggleLog()">toggle log</button>
        </div>

        <script src="/static/package/bootstrap-5.3.8-dist/js/bootstrap.bundle.min.js"></script>
        <script src="/static/javascript/bytejammer.js"></script>
        <script>
            const ws = new BjmrWebSocket()

            window.onload = () => {
                const conn = ws.open("ws://" + document.location.host + "/ws-server");
                if(!conn) {
					addToLog('error', "Your browser does not support WebSockets");
					setWsLocalStatusText('error', "Your browser does not support WebSockets");
                    return;
                }

                addToLog('info', "Websocket to bytejammer.exe: Initialising...");

                conn.onerror = (error) => {
                    addToLog("error", "Websocket to bytejammer.exe");
                }

                conn.onopen = () => {
                    addToLog("success", "Websocket connected to bytejammer.exe");
                    setWsLocalStatusText('success', "Open")
                }
                
                conn.onclose = (event) => {
                    if (event.wasClean) {
						addToLog("info", "Websocket to bytejammer.exe: Clean disconnect");
                        setWsLocalStatusText('success', `Closed: Connection closed cleanly, code=${event.code} reason=${event.reason}`);
                    } else {
						// e.g. server process killed or network down
						// event.code is usually 1006 in this case
						addToLog("error", "Websocket to bytejammer.exe: Unexpected disconnect");
						setWsLocalStatusText('error', 'Closed: Unexpected disconnect');
                    }
                }

                conn.onmessage = (evt) => {
                    const msg = JSON.parse(evt.data);
                    switch(msg.type) {
                        case "server-status":
                            handleMsgServerStatus(msg.data);
                            break;

                        case "log":
                            handleMsgLog(msg);
                            break;

                        default:
                            console.error(`Unhandled message type ${msg.type}`);
                    }
                }
            }
        </script>
    </body>
</html>
